<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');

        :root {
            /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            
            /* Ø§Ù„Ø®Ù„ÙÙŠØ§Øª */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            
            /* Ø§Ù„Ù†ØµÙˆØµ */
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            
            /* Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            --border-color: #e2e8f0;
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            direction: rtl;
            text-align: right;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background-color: var(--bg-primary);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header .logo {
            width: 100px;
            height: auto;
        }

        .header .logo img {
            width: 100%;
            height: auto;
        }

        .header .hospital-info {
            text-align: center;
            flex-grow: 1;
        }

        .header .hospital-info h1 {
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 2rem;
        }

        .header .hospital-info p {
            margin: 2px 0;
            color: var(--text-secondary);
        }

        .report-title {
            text-align: center;
            margin: 20px 0;
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .report-date {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .header-divider {
            border: 0;
            height: 3px;
            background-color: var(--primary-color);
            margin: 15px 0 25px 0;
        }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-primary);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: right;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: var(--bg-secondary);
        }

        tr:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        /* ØªÙ†Ø³ÙŠÙ‚ ØµÙ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ */
        .total-row {
            background-color: rgba(16, 185, 129, 0.1);
            font-weight: bold;
        }

        .total-row td {
            border-top: 2px solid var(--success-color);
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ */
        .total-amount {
            font-weight: bold;
            color: var(--success-color);
            font-size: 1.1em;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« */
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            background-color: var(--bg-primary);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .filter-container input, .filter-container button {
            margin: 0;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: 'Cairo', sans-serif;
        }

        .filter-container button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-container button:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª */
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .pagination-controls button {
            padding: 8px 16px;
            border: none;
            background: linear-gradient(145deg, #4f46e5, #2563eb);
            color: #ffffff;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
            transition: all 0.25s ease-in-out;
        }

        .pagination-controls button:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 10px rgba(0,0,0,0.2);
            background: linear-gradient(145deg, #6b5dd1, #3b82f6);
        }

        .pagination-controls button.active {
            background: linear-gradient(145deg, #2563eb, #1d4ed8);
            box-shadow: 0 4px 8px rgba(0,0,0,0.25);
            cursor: default;
            pointer-events: none;
            transform: scale(1.05);
        }

        .pagination-controls button:disabled {
            background: #d1d5db;
            color: #9ca3af;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        .print-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .print-btn:hover {
            background-color: #475569;
            transform: translateY(-2px);
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ */
        .chart-container {
            margin: 30px auto;
            max-width: 800px;
            height: 300px;
            background-color: var(--bg-primary);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header .logo {
                width: 80px;
            }
            
            .header .hospital-info h1 {
                font-size: 1.5rem;
            }
            
            .report-title {
                font-size: 1.5rem;
            }
        }

        @media print {
            .filter-container, .pagination-controls, .print-btn {
                display: none;
            }
            
            body {
                padding: 0;
                background-color: white;
            }
            
            .container {
                max-width: 100%;
            }
            
            table {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
        <div class="fixed-icons">
    <a href="dashboard.html" title="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" class="icon-home">
        ğŸ 
    </a>
    <a href="new_resulat_pathion.html" title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰" class="icon-patients">
        ğŸ§‘â€âš•ï¸
    </a>
</div>
</div>
<style>
/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© */
.fixed-icons {
    position: fixed;
    bottom: 30px;   /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ */
    right: 0px;    /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† */
    display: flex;
    flex-direction: column;
    gap: 15px;      /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
    z-index: 9999;  /* Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ±Ù‡Ø§ ÙÙˆÙ‚ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙƒØ£Ø²Ø±Ø§Ø± Ø¯Ø§Ø¦Ø±ÙŠØ© */
.fixed-icons a {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #112dff00, #094bf100); /* ØªØ¯Ø±Ø¬ Ø£Ø®Ø¶Ø± Ø¬Ø°Ø§Ø¨ */
    color: white;
    font-size: 28px;
    border-radius: 50% 0 0 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
}

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
.fixed-icons a:hover {
    transform: scale(1.15) rotate(10deg);
    box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    background: linear-gradient(135deg, #0f08dc, #0b51dc);
}

/* Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± ØµØºÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· */
.fixed-icons a:active {
    transform: scale(0.95) rotate(-5deg);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

/* Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ù„ÙƒÙ„ Ø±Ø§Ø¨Ø· Ø¥Ø°Ø§ Ø£Ø­Ø¨Ø¨Øª */
.icon-home {
    background: linear-gradient(135deg, #2196F3, #0b63c9); /* Ø£Ø²Ø±Ù‚ */
}

.icon-home:hover {
    background: linear-gradient(135deg, #0b63c9, #2196F3);
}

.icon-patients {
    background: linear-gradient(135deg, #FF5722, #e03d10); /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
}

.icon-patients:hover {
    background: linear-gradient(135deg, #e03d10, #FF5722);
}
</style>
    <div class="container">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
        <div class="header">
            <div class="logo">
                <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰">
            </div>
            <div class="hospital-info">
                <h1>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ / Ø§Ù„Ù…Ø¹Ù…Ù„</h1>
                <p>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø«Ø§Ù„ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø¯ÙˆÙ„Ø©</p>
                <p>Ù‡Ø§ØªÙ: 0123456789 | Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: info@example.com</p>
            </div>
            <div class="logo">
                <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰">
            </div>
        </div>

        <h1 class="report-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>
        <p class="report-date" id="currentDate"></p>

        <hr class="header-divider">

        <!-- ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« -->
        <div class="filter-container">
            <input type="text" id="patientFilter" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶" oninput="filterResults()">
            <input type="text" id="fileNumberFilter" placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù" oninput="filterResults()">
            <button onclick="resetFilters()" class="btn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„ØªØ±</button>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <table id="dailyReportTable">
            <thead>
                <tr>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</th>
                    <th>Ø§Ù„Ø¹Ù…Ø±</th>
                    <th>Ø§Ù„Ø¬Ù†Ø³</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù</th>
                    <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ­ÙˆØµØ§Øª</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                    <th>ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</th>
                </tr>
            </thead>
            <tbody id="reportTableBody">
                <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§ -->
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="5" style="text-align: left; font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…:</td>
                    <td id="dailyTotalAmount" class="total-amount">0.00 Ø±ÙŠØ§Ù„</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª -->
        <div class="pagination-controls" id="paginationControls"></div>

        <!-- Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
        <button class="print-btn" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>

        <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
        <div class="chart-container">
            <canvas id="financialChart"></canvas>
        </div>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø© Chart.js Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let db;
        let allResults = [];
        let currentPage = 1;
        const rowsPerPage = 250;
        const tableBody = document.getElementById("reportTableBody");
        const paginationDiv = document.getElementById("paginationControls");
        const dailyTotalElement = document.getElementById("dailyTotalAmount");

        // Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
        const today = new Date();
        document.getElementById("currentDate").textContent = formatDate(today);

        // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const request = indexedDB.open("LabManagementDB", 1);

        request.onupgradeneeded = function(event) {
            db = event.target.result;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø²Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if(!db.objectStoreNames.contains("results")) {
                const resultsStore = db.createObjectStore("results", { keyPath: "id", autoIncrement: true });
                resultsStore.createIndex("patientID", "patientID", { unique: false });
                resultsStore.createIndex("date", "date", { unique: false });
            }
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            loadTodayResults();
        };

        request.onerror = function(event) {
            alert("Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + event.target.errorCode);
        };

        // ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø·
        function loadTodayResults() {
            const transaction = db.transaction(["results"], "readonly");
            const store = transaction.objectStore("results");
            const requestAll = store.getAll();

            requestAll.onsuccess = function() {
                const allData = requestAll.result;
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„ÙŠÙˆÙ… Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø·
                const startOfDay = new Date();
                startOfDay.setHours(0, 0, 0, 0);
                
                const endOfDay = new Date();
                endOfDay.setHours(23, 59, 59, 999);
                
                allResults = allData.filter(result => {
                    const resultDate = new Date(result.date);
                    return resultDate >= startOfDay && resultDate <= endOfDay;
                });

                if (allResults.length === 0) {
                    tableBody.innerHTML = "<tr><td colspan='7'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….</td></tr>";
                    paginationDiv.innerHTML = "";
                    dailyTotalElement.textContent = "0.00 Ø±ÙŠØ§Ù„";
                    return;
                }

                // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
                allResults.sort((a, b) => new Date(b.date) - new Date(a.date));

                currentPage = 1; // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
                renderTable();
                renderPagination();
                updateDailyTotal();
                renderChart();
            };

            requestAll.onerror = function(event) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: " + event.target.errorCode);
            };
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function renderTable() {
            tableBody.innerHTML = "";

            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const slice = allResults.slice(start, end);

            slice.forEach(result => {
                const date = new Date(result.date);
                const formattedDate = formatDate(date);

                let totalAmount = result.totalAmount;
                if (totalAmount === undefined) {
                    totalAmount = 0;
                    result.testsResults.forEach(test => {
                        totalAmount += parseFloat(test.price || 0);
                    });
                }

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${result.patientName}</td>
                    <td>${result.patientAge}</td>
                    <td>${result.patientGender}</td>
                    <td>${result.patientID}</td>
                    <td>${result.testsResults.length}</td>
                    <td class="total-amount">${totalAmount.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                    <td>${formattedDate}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Ø±Ø³Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª
        function renderPagination() {
            paginationDiv.innerHTML = "";
            const totalPages = Math.ceil(allResults.length / rowsPerPage);

            if (totalPages <= 1) {
                return;
            }

            // Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
            const prevBtn = document.createElement("button");
            prevBtn.textContent = "Ø§Ù„Ø³Ø§Ø¨Ù‚";
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => { currentPage--; renderTable(); renderPagination(); };
            paginationDiv.appendChild(prevBtn);

            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement("button");
                btn.textContent = i;
                if (i === currentPage) {
                    btn.classList.add("active");
                }
                btn.onclick = () => { currentPage = i; renderTable(); renderPagination(); };
                paginationDiv.appendChild(btn);
            }

            // Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
            const nextBtn = document.createElement("button");
            nextBtn.textContent = "Ø§Ù„ØªØ§Ù„ÙŠ";
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => { currentPage++; renderTable(); renderPagination(); };
            paginationDiv.appendChild(nextBtn);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…
        function updateDailyTotal() {
            const dailyTotal = allResults.reduce((sum, result) => {
                let total = result.totalAmount;
                if (total === undefined) {
                    total = 0;
                    result.testsResults.forEach(test => {
                        total += parseFloat(test.price || 0);
                    });
                }
                return sum + total;
            }, 0);
            
            dailyTotalElement.textContent = dailyTotal.toFixed(2) + " Ø±ÙŠØ§Ù„";
        }

        // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø§Ù„ÙŠØ§Øª
        function renderChart() {
            const ctx = document.getElementById('financialChart').getContext('2d');
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©
            const hourlyData = {};
            const patientCounts = {};
            
            allResults.forEach(result => {
                const date = new Date(result.date);
                const hour = date.getHours();
                
                if (!hourlyData[hour]) {
                    hourlyData[hour] = 0;
                    patientCounts[hour] = 0;
                }
                
                let total = result.totalAmount;
                if (total === undefined) {
                    total = 0;
                    result.testsResults.forEach(test => {
                        total += parseFloat(test.price || 0);
                    });
                }
                
                hourlyData[hour] += total;
                patientCounts[hour]++;
            });
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
            const hours = Object.keys(hourlyData).sort((a, b) => a - b);
            const amounts = hours.map(hour => hourlyData[hour]);
            const counts = hours.map(hour => patientCounts[hour]);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hours.map(hour => hour + ':00'),
                    datasets: [
                        {
                            label: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø±ÙŠØ§Ù„)',
                            data: amounts,
                            backgroundColor: 'rgba(37, 99, 235, 0.7)',
                            borderColor: 'rgba(37, 99, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰',
                            data: counts,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø±ÙŠØ§Ù„)'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            title: {
                                display: true,
                                text: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function filterResults() {
            const patientFilter = document.getElementById('patientFilter').value.toLowerCase();
            const fileNumberFilter = document.getElementById('fileNumberFilter').value.toLowerCase();
            
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                // ØªØ¬Ø§Ù‡Ù„ ØµÙ "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬"
                if (row.cells.length === 1 && row.cells[0].getAttribute('colspan')) {
                    return;
                }
                
                const patientName = row.cells[0].textContent.toLowerCase();
                const fileNumber = row.cells[3].textContent.toLowerCase();
                
                let showRow = true;
                
                if (patientFilter && !patientName.includes(patientFilter)) {
                    showRow = false;
                }
                
                if (fileNumberFilter && !fileNumber.includes(fileNumberFilter)) {
                    showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø«
        function resetFilters() {
            document.getElementById('patientFilter').value = '';
            document.getElementById('fileNumberFilter').value = '';
            filterResults();
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }
    </script>
</body>
</html>
